

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Pandaos">
  <meta name="keywords" content="">
  <title>编写decaf语法解析器 - Pandaos&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"panda0s.top","root":"/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="Pandaos's blog" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Panadaos</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/atom.xml">
                <i class="iconfont icon-rss-fill"></i>
                Rss
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                Links
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/bg.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="编写decaf语法解析器">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-01-25 22:49" pubdate>
        January 25, 2021 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      5.3k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      101
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">编写decaf语法解析器</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：3 months ago
                
              </p>
            
            <div class="markdown-body">
              <h1 id="编写-Decaf-语法解析器"><a href="#编写-Decaf-语法解析器" class="headerlink" title="编写 Decaf 语法解析器"></a>编写 Decaf 语法解析器</h1><p>Decaf 是 SFU  Compiler 课程要实现的语言，前一篇 Blog 写了如何编写 Decaf 词法分析器, 这一篇 Blog 则是写 Decaf 编译器的第二个阶段，语法解析。语法解析器的作用是解析程序语法，并生成抽象语法树 (Abstract Syntax Tree)，抽象语法树（AST）是程序结构的一种高抽象层次的表达，有了它我们并再不需要源代码的存在了。它可以认为是源代码等价的一种抽象表达。语法解析依赖许多理论基础，前几篇 Blog 我简单地总结了对 LR Parser 的理解（目前，SLR(1), LR(1), LL(1) 均没有总结）。Parser 的理论知识非常抽象，我只理解一些皮毛，但是我已经理解的语法解析知识足够我利用 Yacc 编写语法解析器了。我在编写 Decaf 过程中，遇到的最大的问题有两个:</p>
<ol>
<li>Shift / Reduce Conflict</li>
<li>抽象语法树数据结构设计</li>
</ol>
<p>Decaf 语言说明文件: </p>
<h2 id="ASDL"><a href="#ASDL" class="headerlink" title="ASDL"></a>ASDL</h2><p>Decaf 的抽象语法树定义语言用的是 <a target="_blank" rel="noopener" href="http://www.oilshell.org/blog/2016/12/11.html">Zehpyr Abstract Syntax Definition Language</a></p>
<p>抽象语法定义语言可以定义抽象语法树相关的数据结构。</p>
<p>Decaf 的抽象语法树定义如下(Decaf.asdl)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs ASDL">-- Decaf abstract syntax tree definition<br><br>-- The specification of the AST nodes is specified using the Zephyr<br>-- Abstract Syntax Definition Language (ASDL) [Wang97]<br><br>-- The abstract syntax tree (AST) is a high-level representation<br>-- of the program structure without the necessity of containing the<br>-- source code; it can be thought of as an abstract representation of<br>-- the source code.<br><br>-- Modifiers on the argument type specify the number of values<br>-- needed; &#39;?&#39; means it is optional, &#39;*&#39; means 0 or more (with commas), <br>-- no modifier means only one value for the argument and it is required.<br><br>-- For * print a singleton for one element, or multiple<br>-- elements seperated by commas, or None for the zero element.<br><br>-- ASDL&#39;s four builtin types are identifier, int, string, object<br><br>module Decaf<br>&#123;<br>    prog &#x3D; Program(extern* extern_list, package body)<br><br>    extern &#x3D; ExternFunction(identifier name, method_type return_type, extern_type* typelist)<br><br>    decaf_type &#x3D; IntType | BoolType<br><br>    method_type &#x3D; VoidType | decaf_type<br><br>    extern_type  &#x3D; VarDef(StringType) | VarDef(decaf_type)<br><br>    package &#x3D; Package(identifier name, field_decl* field_list, method_decl* method_list)<br><br>    field_decl &#x3D; FieldDecl(identifier name, decaf_type type, field_size size)<br>        | AssignGlobalVar(identifier name, decaf_type type, constant value)<br><br>    field_size &#x3D; Scalar | Array(int array_size)<br><br>    method_decl &#x3D; Method(identifier name, method_type return_type, typed_symbol* param_list, method_block block)<br><br>    typed_symbol &#x3D; VarDef(identifier name, decaf_type type)<br><br>    method_block &#x3D; MethodBlock(typed_symbol* var_decl_list, statement* statement_list)<br><br>    block &#x3D; Block(typed_symbol* var_decl_list, statement* statement_list)<br><br>    statement &#x3D; assign<br>        | method_call<br>        | IfStmt(expr condition, block if_block, block? else_block)<br>        | WhileStmt(expr condition, block while_block)<br>        | ForStmt(assign* pre_assign_list, expr condition, assign* loop_assign_list, block for_block)<br>        | ReturnStmt(expr? return_value)<br>        | BreakStmt<br>        | ContinueStmt<br>        | block<br><br>    assign &#x3D; AssignVar(identifier name, expr value)<br>        | AssignArrayLoc(identifier name, expr index, expr value)<br><br>    method_call &#x3D; MethodCall(identifier name, method_arg* method_arg_list)<br><br>    method_arg &#x3D; StringConstant(string value)<br>        | expr<br><br>    expr &#x3D; rvalue<br>        | method_call<br>        | constant<br>        | BinaryExpr(binary_operator op, expr left_value, expr right_value)<br>        | UnaryExpr(unary_operator op, expr value)<br><br>    constant &#x3D; NumberExpr(int value)<br>        | BoolExpr(bool value)<br><br>    rvalue &#x3D; VariableExpr(identifier name)<br>        | ArrayLocExpr(identifier name, expr index)<br><br>    bool &#x3D; True | False<br><br>    binary_operator &#x3D; Plus | Minus | Mult | Div | Leftshift | Rightshift | Mod | Lt | Gt | Leq | Geq | Eq | Neq | And | Or<br><br>    unary_operator &#x3D; UnaryMinus | Not<br>&#125;<br>-- References<br>-- [Wang97] Daniel C. Wang, Andrew W. Appel, Jeff L. Korn, and Chris<br>-- S. Serra. The Zephyr Abstract Syntax Description Language. In<br>-- Proceedings of the Conference on Domain-Specific Languages, pp.<br>-- 213--227, 1997.<br></code></pre></td></tr></table></figure>
<p>例如 Program 和 ExternFunction 都是 Decaf 抽象语法树中的数据结构，使用 C++ 实现定义如下</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// Program(extern* extern_list, package body)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProgramAST</span> :</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	decafStmtList *ExternList;<br>	PackageAST *PackageDef;<br><span class="hljs-keyword">public</span>:<br>	ProgramAST(decafStmtList *externs, PackageAST *c) : ExternList(externs), PackageDef(c) &#123;&#125;<br>	~ProgramAST() &#123; <br>		<span class="hljs-keyword">if</span> (ExternList != <span class="hljs-literal">NULL</span>) &#123; <span class="hljs-keyword">delete</span> ExternList; &#125; <br>		<span class="hljs-keyword">if</span> (PackageDef != <span class="hljs-literal">NULL</span>) &#123; <span class="hljs-keyword">delete</span> PackageDef; &#125;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;Program&quot;</span>) + <span class="hljs-string">&quot;(&quot;</span> + getString(ExternList) + <span class="hljs-string">&quot;,&quot;</span> + getString(PackageDef) + <span class="hljs-string">&quot;)&quot;</span>; &#125;<br>&#125;;<br><br><br><span class="hljs-comment">// ExternFunction(identifier name, method_type return_type, extern_type* typelist)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExternFunctionAST</span> :</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	<span class="hljs-built_in">string</span> Name;<br>	TypeAST * ReturnType;<br>	VarDefAST * VarList;<br><br><span class="hljs-keyword">public</span>:<br>	ExternFunctionAST(<span class="hljs-built_in">string</span> name, TypeAST * returntype, VarDefAST * varlist): Name(name), ReturnType(returntype), VarList(varlist) &#123;&#125;<br>	~ExternFunctionAST() &#123;<br>		<span class="hljs-keyword">if</span>( VarList ) <span class="hljs-keyword">delete</span> VarList;<br>		<span class="hljs-keyword">if</span>( ReturnType ) <span class="hljs-keyword">delete</span> ReturnType;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;ExternFunction&quot;</span>)  + <span class="hljs-string">&quot;(&quot;</span> + Name + <span class="hljs-string">&quot;,&quot;</span> + getString(ReturnType) + <span class="hljs-string">&quot;,&quot;</span> + getString(VarList) + <span class="hljs-string">&quot;)&quot;</span>;<br>	&#125;<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>其中 <code>string str()</code> 是 <code>decafAST</code> 基类中定义的用于 AST 序列化的虚函数。</p>
<p>decaf 程序如下:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go">extern <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">print_int</span><span class="hljs-params">(<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>)</span> <span class="hljs-title">void</span>;</span><br><span class="hljs-keyword">package</span> QuickSort &#123;<br>	<span class="hljs-keyword">var</span> x <span class="hljs-keyword">int</span>;<br>	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> <span class="hljs-title">void</span></span> &#123;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>序列化之后的结果如下</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">Program(ExternFunction(print_int,VoidType,VarDef(IntType,IntType)),Package(QuickSort,FieldDecl(x,IntType,Scalar),<span class="hljs-function"><span class="hljs-keyword">Method</span><span class="hljs-params">(main,VoidType,None,MethodBlock(None,None)</span>)))</span><br></code></pre></td></tr></table></figure>
<h2 id="Decaf-语法定义"><a href="#Decaf-语法定义" class="headerlink" title="Decaf 语法定义"></a>Decaf 语法定义</h2><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">Program</span> = Externs package identifier <span class="hljs-string">&quot;&#123;&quot;</span> FieldDecls MethodDecls <span class="hljs-string">&quot;&#125;&quot;</span> .<br><span class="hljs-attr">Externs</span>    = &#123; ExternDefn &#125; .<br><span class="hljs-attr">ExternDefn</span> = extern func identifier <span class="hljs-string">&quot;(&quot;</span> [ &#123; ExternType &#125;+, ] <span class="hljs-string">&quot;)&quot;</span> MethodType <span class="hljs-string">&quot;;&quot;</span> .<br><span class="hljs-attr">FieldDecls</span> = &#123; FieldDecl &#125; .<br><span class="hljs-attr">FieldDecl</span>  = var &#123; identifier &#125;+, Type <span class="hljs-string">&quot;;&quot;</span> .<br><span class="hljs-attr">FieldDecl</span>  = var &#123; identifier &#125;+, ArrayType <span class="hljs-string">&quot;;&quot;</span> .<br><span class="hljs-attr">FieldDecl</span>  = var identifier Type <span class="hljs-string">&quot;=&quot;</span> Constant <span class="hljs-string">&quot;;&quot;</span> .<br><span class="hljs-attr">MethodDecls</span> = &#123; MethodDecl &#125; .<br><span class="hljs-attr">MethodDecl</span>  = func identifier <span class="hljs-string">&quot;(&quot;</span> [ &#123; identifier Type &#125;+, ] <span class="hljs-string">&quot;)&quot;</span> MethodType Block .<br><span class="hljs-attr">Block</span> = <span class="hljs-string">&quot;&#123;&quot;</span> VarDecls Statements <span class="hljs-string">&quot;&#125;&quot;</span> .<br><span class="hljs-attr">VarDecls</span> = &#123; VarDecl &#125; .<br><span class="hljs-attr">VarDecl</span>  = var &#123; identifier &#125;+, Type <span class="hljs-string">&quot;;&quot;</span> .<br><span class="hljs-attr">Statements</span> = &#123; Statement &#125; .<br><span class="hljs-attr">Statement</span> = Block .<br><span class="hljs-attr">Statement</span> = Assign <span class="hljs-string">&quot;;&quot;</span> .<br><span class="hljs-attr">Assign</span>    = Lvalue <span class="hljs-string">&quot;=&quot;</span> Expr .<br><span class="hljs-attr">Lvalue</span>    = identifier | identifier <span class="hljs-string">&quot;[&quot;</span> Expr <span class="hljs-string">&quot;]&quot;</span> .<br><span class="hljs-attr">Statement</span>  = MethodCall <span class="hljs-string">&quot;;&quot;</span> .<br><span class="hljs-attr">MethodCall</span> = identifier <span class="hljs-string">&quot;(&quot;</span> [ &#123; MethodArg &#125;+, ] <span class="hljs-string">&quot;)&quot;</span> .<br><span class="hljs-attr">MethodArg</span>  = Expr | string_lit .<br><span class="hljs-attr">Statement</span> = if <span class="hljs-string">&quot;(&quot;</span> Expr <span class="hljs-string">&quot;)&quot;</span> Block [ else Block ] .<br><span class="hljs-attr">Statement</span> =  while <span class="hljs-string">&quot;(&quot;</span> Expr <span class="hljs-string">&quot;)&quot;</span> Block .<br><span class="hljs-attr">Statement</span> = for <span class="hljs-string">&quot;(&quot;</span> &#123; Assign &#125;+, <span class="hljs-string">&quot;;&quot;</span> Expr <span class="hljs-string">&quot;;&quot;</span> &#123; Assign &#125;+, <span class="hljs-string">&quot;)&quot;</span> Block .<br><span class="hljs-attr">Statement</span> = return [ <span class="hljs-string">&quot;(&quot;</span> [ Expr ] <span class="hljs-string">&quot;)&quot;</span> ] <span class="hljs-string">&quot;;&quot;</span> .<br><span class="hljs-attr">Statement</span> = break <span class="hljs-string">&quot;;&quot;</span> .<br><span class="hljs-attr">Statement</span> = continue <span class="hljs-string">&quot;;&quot;</span> .<br><span class="hljs-attr">Expr</span> = identifier .<br><span class="hljs-attr">Expr</span> = MethodCall .<br><span class="hljs-attr">Expr</span> = Constant .<br><span class="hljs-attr">UnaryOperator</span> = ( UnaryNot | UnaryMinus ) .<br><span class="hljs-attr">UnaryNot</span> = <span class="hljs-string">&quot;!&quot;</span> .<br><span class="hljs-attr">UnaryMinus</span> = <span class="hljs-string">&quot;-&quot;</span> .<br><span class="hljs-attr">BinaryOperator</span> = ( ArithmeticOperator | BooleanOperator ) .<br><span class="hljs-attr">ArithmeticOperator</span> = ( <span class="hljs-string">&quot;+&quot;</span> | <span class="hljs-string">&quot;-&quot;</span> | <span class="hljs-string">&quot;*&quot;</span> | <span class="hljs-string">&quot;/&quot;</span> | <span class="hljs-string">&quot;&lt;&lt;&quot;</span> | <span class="hljs-string">&quot;&gt;&gt;&quot;</span> | <span class="hljs-string">&quot;%&quot;</span> ) .<br><span class="hljs-attr">BooleanOperator</span> = ( <span class="hljs-string">&quot;==&quot;</span> | <span class="hljs-string">&quot;!=&quot;</span> | <span class="hljs-string">&quot;&lt;&quot;</span> | <span class="hljs-string">&quot;&lt;=&quot;</span> | <span class="hljs-string">&quot;&gt;&quot;</span> | <span class="hljs-string">&quot;&gt;=&quot;</span> | <span class="hljs-string">&quot;&amp;&amp;&quot;</span> | <span class="hljs-string">&quot;||&quot;</span> ) .<br><span class="hljs-attr">Expr</span> = Expr BinaryOperator Expr .<br><span class="hljs-attr">Expr</span> = UnaryOperator Expr .<br><span class="hljs-attr">Expr</span> = <span class="hljs-string">&quot;(&quot;</span> Expr <span class="hljs-string">&quot;)&quot;</span> .<br><span class="hljs-attr">Expr</span> = identifier <span class="hljs-string">&quot;[&quot;</span> Expr <span class="hljs-string">&quot;]&quot;</span> .<br><span class="hljs-attr">ExternType</span> = ( string | Type ) .<br><span class="hljs-attr">Type</span> = ( int | bool ) .<br><span class="hljs-attr">MethodType</span> = ( void | Type ) .<br><span class="hljs-attr">BoolConstant</span> = ( <span class="hljs-literal">true</span> | <span class="hljs-literal">false</span> ) .<br><span class="hljs-attr">ArrayType</span> = <span class="hljs-string">&quot;[&quot;</span> int_lit <span class="hljs-string">&quot;]&quot;</span> Type .<br><span class="hljs-attr">Constant</span> = ( int_lit | char_lit | BoolConstant ) .<br></code></pre></td></tr></table></figure>
<p>根据 Decaf.asdl 定义实现 decafast.cc</p>
<p>根据 Decaf 语法定义实现 decafast.y </p>
<p>两个文件和起来就撸出来一个语法解析器，将 Decaf 源代码转换成语法树。</p>
<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2><p>记录下错误处理，flex 不会自动更新 yylineno 变量，解析出错后不能知道确切的行号，解决方法如下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp">%&#123;<br><span class="hljs-keyword">extern</span> <span class="hljs-keyword">int</span> yylineno;<br>%&#125;<br><br><br>%option yylineno<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">yyerror</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *s)</span> </span>&#123;<br>  <span class="hljs-built_in">cerr</span> &lt;&lt; yylineno &lt;&lt; <span class="hljs-string">&quot;:&quot;</span> &lt;&lt; s &lt;&lt; <span class="hljs-built_in">endl</span>;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>


<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><p><a target="_blank" rel="noopener" href="https://github.com/P4nda0s/compilers-class-hw/tree/master/decafast/answer">https://github.com/P4nda0s/compilers-class-hw/tree/master/decafast/answer</a></p>
<h3 id="lex-代码-decafast-lex"><a href="#lex-代码-decafast-lex" class="headerlink" title="lex 代码: decafast.lex"></a>lex 代码: decafast.lex</h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs livescript">%&#123;<br><span class="hljs-comment">#include &quot;default-defs.h&quot;</span><br><span class="hljs-comment">#include &quot;decafast.tab.h&quot;</span><br><span class="hljs-comment">#include &lt;cstring&gt;</span><br><span class="hljs-comment">#include &lt;string&gt;</span><br><span class="hljs-comment">#include &lt;sstream&gt;</span><br><span class="hljs-comment">#include &lt;iostream&gt;</span><br>using namespace std;<br>extern int yylineno;<br>extern int yytokenpos;<br>string &amp; covert_newline(string &amp; s)&#123;<br>    string tmp = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">for</span>(size_t i = <span class="hljs-number">0</span>; i &lt; s.size(); i++)<br>      <span class="hljs-keyword">if</span>(s[i] == <span class="hljs-string">&#x27;\n&#x27;</span>)<br>        tmp += <span class="hljs-string">&quot;\\n&quot;</span>;<br>      <span class="hljs-keyword">else</span><br>        tmp += s[i];<br>    s = tmp;<br>    <span class="hljs-keyword">return</span> s;<br>&#125;<br><br>%&#125;<br>%option yylineno<br>%%<br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">    Pattern definitions for all tokens1</span><br><span class="hljs-comment">  */</span><br><span class="hljs-string">\&#123;</span>                         &#123; <span class="hljs-keyword">return</span> T_LCB; &#125;<br><span class="hljs-string">\&#125;</span>                         &#123; <span class="hljs-keyword">return</span> T_RCB; &#125;<br>bool                       &#123; yylval.sval = <span class="hljs-keyword">new</span> string(<span class="hljs-string">&quot;BoolType&quot;</span>); <span class="hljs-keyword">return</span> T_BOOLTYPE; &#125;<br>package                    &#123; <span class="hljs-keyword">return</span> T_PACKAGE; &#125;<br>func                       &#123; <span class="hljs-keyword">return</span> T_FUNC; &#125;<br><span class="hljs-keyword">return</span>                     &#123; <span class="hljs-keyword">return</span> T_RETURN; &#125;<br><span class="hljs-keyword">while</span>                      &#123; <span class="hljs-keyword">return</span> T_WHILE; &#125;<br><span class="hljs-literal">void</span>                       &#123; yylval.sval = <span class="hljs-keyword">new</span> string(<span class="hljs-string">&quot;VoidType&quot;</span>);<span class="hljs-keyword">return</span> T_VOID; &#125;<br><span class="hljs-keyword">var</span>                        &#123; <span class="hljs-keyword">return</span> T_VAR; &#125;<br>string                     &#123; yylval.sval = <span class="hljs-keyword">new</span> string(<span class="hljs-string">&quot;StringType&quot;</span>);<span class="hljs-keyword">return</span> T_STRINGTYPE; &#125;<br><span class="hljs-literal">true</span>                       &#123; <span class="hljs-keyword">return</span> T_TRUE; &#125;<br><span class="hljs-literal">null</span>                       &#123; <span class="hljs-keyword">return</span> T_NULL; &#125;<br>int                        &#123; yylval.sval = <span class="hljs-keyword">new</span> string(<span class="hljs-string">&quot;IntType&quot;</span>);<span class="hljs-keyword">return</span> T_INTTYPE; &#125;<br><span class="hljs-keyword">if</span>                         &#123; <span class="hljs-keyword">return</span> T_IF; &#125;<br>extern                     &#123; <span class="hljs-keyword">return</span> T_EXTERN; &#125;<br><span class="hljs-keyword">for</span>                        &#123; <span class="hljs-keyword">return</span> T_FOR; &#125;<br><span class="hljs-keyword">break</span>                      &#123; <span class="hljs-keyword">return</span> T_BREAK; &#125;<br><span class="hljs-keyword">continue</span>                   &#123; <span class="hljs-keyword">return</span> T_CONTINUE; &#125;<br><span class="hljs-keyword">else</span>                       &#123; <span class="hljs-keyword">return</span> T_ELSE; &#125;<br><span class="hljs-literal">false</span>                      &#123; <span class="hljs-keyword">return</span> T_FALSE; &#125;<br>[a-zA-Z<span class="hljs-string">\_][a-zA-Z\_0-9]*</span>   &#123; yylval.sval = <span class="hljs-keyword">new</span> string(yytext); <span class="hljs-keyword">return</span> T_ID; &#125;<br>,                          &#123; <span class="hljs-keyword">return</span> T_COMMA; &#125;<br>==                         &#123; <span class="hljs-keyword">return</span> T_EQ;  &#125;<br>&gt;=                         &#123; <span class="hljs-keyword">return</span> T_GEQ; &#125;<br>&gt;                          &#123; <span class="hljs-keyword">return</span> T_GT;  &#125;<br><span class="hljs-string">\&lt;\&lt;</span>                       &#123; <span class="hljs-keyword">return</span> T_LEFTSHIFT;  &#125;<br>&gt;&gt;                         &#123; <span class="hljs-keyword">return</span> T_RIGHTSHIFT; &#125;<br><span class="hljs-string">\&lt;=</span>                        &#123; <span class="hljs-keyword">return</span> T_LEQ; &#125;<br><span class="hljs-string">\[</span>                         &#123; <span class="hljs-keyword">return</span> T_LSB; &#125;<br><span class="hljs-string">\]</span>                         &#123; <span class="hljs-keyword">return</span> T_RSB; &#125;<br><span class="hljs-string">\&lt;</span>                         &#123; <span class="hljs-keyword">return</span> T_LT; &#125;<br><span class="hljs-string">\-</span>                         &#123; <span class="hljs-keyword">return</span> T_MINUS; &#125;<br><span class="hljs-string">\+</span>                         &#123; <span class="hljs-keyword">return</span> T_PLUS; &#125;<br><span class="hljs-string">\%</span>                         &#123; <span class="hljs-keyword">return</span> T_MOD; &#125;<br><span class="hljs-string">\*</span>                         &#123; <span class="hljs-keyword">return</span> T_MULT; &#125;<br>!=                         &#123; <span class="hljs-keyword">return</span> T_NEQ; &#125;<br>!                          &#123; <span class="hljs-keyword">return</span> T_NOT; &#125;<br><span class="hljs-string">\|\|</span>                       &#123; <span class="hljs-keyword">return</span> T_OR; &#125;<br>;                          &#123; <span class="hljs-keyword">return</span> T_SEMICOLON; &#125;<br><span class="hljs-string">\&quot;([^\n&quot;\\]|\\(a|b|t|n|v|f|r|\\|\&#x27;|\&quot;))*\&quot;</span> &#123;  yylval.sval = <span class="hljs-keyword">new</span> string(yytext); <span class="hljs-keyword">return</span> T_STRINGCONSTANT; &#125;<br><br>([<span class="hljs-number">0</span>-<span class="hljs-number">9</span>]+(<span class="hljs-string">\.[0-9]+)?)|(0[xX][0-9A-Fa-f]+)</span>          &#123; yylval.sval = <span class="hljs-keyword">new</span> string(yytext); <span class="hljs-keyword">return</span> T_INTCONSTANT; &#125;<br><span class="hljs-string">\&#x27;([^\n&#x27;\\]|\\(a|b|t|n|v|f|r|\\|\&#x27;|\&quot;))\&#x27;</span>        &#123; yylval.sval = <span class="hljs-keyword">new</span> string(yytext); <span class="hljs-keyword">return</span> T_CHARCONSTANT; &#125;<br><span class="hljs-string">&quot;//&quot;</span>.*<span class="hljs-string">&quot;\n&quot;</span>                 &#123;  &#125;<br><span class="hljs-string">\(</span>                         &#123; <span class="hljs-keyword">return</span> T_LPAREN; &#125;<br><span class="hljs-string">\)</span>                         &#123; <span class="hljs-keyword">return</span> T_RPAREN; &#125;<br><br>&amp;&amp;                         &#123; <span class="hljs-keyword">return</span> T_AND; &#125;<br>=                          &#123; <span class="hljs-keyword">return</span> T_ASSIGN; &#125;<br><span class="hljs-string">\/</span>                         &#123; <span class="hljs-keyword">return</span> T_DIV; &#125;<br><span class="hljs-string">&quot;.&quot;</span>                        &#123; <span class="hljs-keyword">return</span> T_DOT; &#125; <br>[<span class="hljs-string">\t\r\n\a\v\b</span> ]+           &#123;  &#125; <span class="hljs-comment">/* ignore whitespace */</span><br>.                          &#123; cerr &lt;&lt; <span class="hljs-string">&quot;Error: unexpected character in input&quot;</span> &lt;&lt; endl; <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>; &#125;<br>%%<br><br>int yyerror(<span class="hljs-keyword">const</span> char *s) &#123;<br>  cerr &lt;&lt; yylineno &lt;&lt; <span class="hljs-string">&quot;:&quot;</span> &lt;&lt; s &lt;&lt; endl;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h3 id="yacc-代码-decafast-y"><a href="#yacc-代码-decafast-y" class="headerlink" title="yacc 代码: decafast.y"></a>yacc 代码: decafast.y</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br></pre></td><td class="code"><pre><code class="hljs powershell">%&#123;<br><span class="hljs-comment">#include &lt;iostream&gt;</span><br><span class="hljs-comment">#include &lt;ostream&gt;</span><br><span class="hljs-comment">#include &lt;string&gt;</span><br><span class="hljs-comment">#include &lt;cstdlib&gt;</span><br><span class="hljs-comment">#include &lt;vector&gt;</span><br><span class="hljs-comment">#include &quot;default-defs.h&quot;</span><br><br>int yylex(void);<br>int yyerror(char *); <br><br>// print AST<br>bool printAST = true;<br><span class="hljs-comment">#include &quot;decafast.cc&quot;</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br>string proceesCharLit(string charlit) &#123;<br>    // a|b|t|n|v|f|<span class="hljs-built_in">r</span><br>    <span class="hljs-keyword">if</span> (charlit[<span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;\\&#x27;</span>)&#123;<br>        <span class="hljs-keyword">switch</span> (charlit[<span class="hljs-number">2</span>])&#123;<br>            case <span class="hljs-string">&#x27;n&#x27;</span>:<br>                <span class="hljs-keyword">return</span> to_string(<span class="hljs-string">&#x27;\n&#x27;</span>);<br>            case <span class="hljs-string">&#x27;a&#x27;</span>:<br>                <span class="hljs-keyword">return</span> to_string(<span class="hljs-string">&#x27;\a&#x27;</span>);<br>            case <span class="hljs-string">&#x27;b&#x27;</span>:<br>                <span class="hljs-keyword">return</span> to_string(<span class="hljs-string">&#x27;\b&#x27;</span>);<br>            case <span class="hljs-string">&#x27;t&#x27;</span>:<br>                <span class="hljs-keyword">return</span> to_string(<span class="hljs-string">&#x27;\t&#x27;</span>);<br>            case <span class="hljs-string">&#x27;v&#x27;</span>:<br>                <span class="hljs-keyword">return</span> to_string(<span class="hljs-string">&#x27;\v&#x27;</span>);<br>            case <span class="hljs-string">&#x27;f&#x27;</span>:<br>                <span class="hljs-keyword">return</span> to_string(<span class="hljs-string">&#x27;\f&#x27;</span>);<br>            case <span class="hljs-string">&#x27;r&#x27;</span>:<br>                <span class="hljs-keyword">return</span> to_string(<span class="hljs-string">&#x27;\r&#x27;</span>);<br>            case <span class="hljs-string">&#x27;\\&#x27;</span>:<br>                <span class="hljs-keyword">return</span> to_string(<span class="hljs-string">&#x27;\\&#x27;</span>);<br>            case <span class="hljs-string">&#x27;\&#x27;</span><span class="hljs-string">&#x27;:</span><br><span class="hljs-string">                return to_string(&#x27;</span>\<span class="hljs-string">&#x27;&#x27;</span>);<br>            case <span class="hljs-string">&#x27;\&quot;&#x27;</span>:<br>                <span class="hljs-keyword">return</span> to_string(<span class="hljs-string">&#x27;\&quot;&#x27;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> to_string(charlit[<span class="hljs-number">1</span>]);<br>&#125;<br>%&#125;<br><br>%union&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">decafAST</span> *<span class="hljs-title">ast</span>;</span><br><span class="hljs-class">    <span class="hljs-title">std</span>::<span class="hljs-title">string</span> *<span class="hljs-title">sval</span>;</span><br><span class="hljs-class">    <span class="hljs-title">std</span>::<span class="hljs-title">vector</span>&lt;<span class="hljs-title">std</span>::<span class="hljs-title">string</span>&gt; *<span class="hljs-title">svals</span>;</span><br><span class="hljs-class"> &#125;</span><br><span class="hljs-class"></span><br><span class="hljs-class">%<span class="hljs-title">token</span> <span class="hljs-title">T_PACKAGE</span></span><br><span class="hljs-class">%<span class="hljs-title">token</span> <span class="hljs-title">T_LCB</span></span><br><span class="hljs-class">%<span class="hljs-title">token</span> <span class="hljs-title">T_RCB</span></span><br><span class="hljs-class">%<span class="hljs-title">token</span> &lt;<span class="hljs-title">sval</span>&gt; <span class="hljs-title">T_ID</span> <span class="hljs-title">T_STRINGTYPE</span> <span class="hljs-title">T_INTTYPE</span> <span class="hljs-title">T_BOOLTYPE</span>  <span class="hljs-title">T_VOID</span> <span class="hljs-title">T_INTCONSTANT</span> <span class="hljs-title">T_STRINGCONSTANT</span> <span class="hljs-title">T_CHARCONSTANT</span></span><br><span class="hljs-class">%<span class="hljs-title">token</span> <span class="hljs-title">T_N_TOKEN</span> <span class="hljs-title">T_FUNC</span> <span class="hljs-title">T_INT</span> <span class="hljs-title">T_LPAREN</span> <span class="hljs-title">T_RPAREN</span> <span class="hljs-title">T_WHITESPACE</span> <span class="hljs-title">T_WHITESPACE_N</span> <span class="hljs-title">T_AND</span> <span class="hljs-title">T_ASSIGN</span>  <span class="hljs-title">T_BREAK</span> <span class="hljs-title">T_COMMA</span> <span class="hljs-title">T_COMMENT</span>  <span class="hljs-title">T_CONTINUE</span>  <span class="hljs-title">T_DIV</span>  <span class="hljs-title">T_DOT</span>  <span class="hljs-title">T_ELSE</span>  <span class="hljs-title">T_EQ</span>  <span class="hljs-title">T_EXTERN</span>  <span class="hljs-title">T_FALSE</span>  <span class="hljs-title">T_FOR</span>  <span class="hljs-title">T_GEQ</span>  <span class="hljs-title">T_GT</span>  <span class="hljs-title">T_IF</span> <span class="hljs-title">T_LEFTSHIFT</span>  <span class="hljs-title">T_LEQ</span>  <span class="hljs-title">T_LSB</span>  <span class="hljs-title">T_LT</span>  <span class="hljs-title">T_MINUS</span>  <span class="hljs-title">T_MOD</span>  <span class="hljs-title">T_MULT</span> <span class="hljs-title">T_NEQ</span>  <span class="hljs-title">T_NOT</span>  <span class="hljs-title">T_NULL</span>  <span class="hljs-title">T_OR</span>  <span class="hljs-title">T_PLUS</span>  <span class="hljs-title">T_RIGHTSHIFT</span>  <span class="hljs-title">T_RSB</span>  <span class="hljs-title">T_SEMICOLON</span> <span class="hljs-title">T_TRUE</span>  <span class="hljs-title">T_VAR</span>  <span class="hljs-title">T_WHILE</span>  <span class="hljs-title">T_RETURN</span></span><br><span class="hljs-class">%<span class="hljs-title">type</span> &lt;<span class="hljs-title">ast</span>&gt; <span class="hljs-title">return_type</span> <span class="hljs-title">extern_list</span> <span class="hljs-title">decafpackage</span> <span class="hljs-title">extern_stmt</span> <span class="hljs-title">extern_var_list</span> <span class="hljs-title">ExternType</span> <span class="hljs-title">program</span> <span class="hljs-title">field_list</span> <span class="hljs-title">method_list</span> <span class="hljs-title">MethodDecl</span> <span class="hljs-title">FieldDecl</span> <span class="hljs-title">normal_type</span> <span class="hljs-title">constant_expr</span> <span class="hljs-title">T_TRUE</span> <span class="hljs-title">T_FALSE</span> <span class="hljs-title">typed_var_defs</span> <span class="hljs-title">Block</span> <span class="hljs-title">Statement</span> <span class="hljs-title">Statements</span> <span class="hljs-title">MethodArg</span> <span class="hljs-title">MethodArgList</span> <span class="hljs-title">ForAssignList</span>  <span class="hljs-title">ElseBlock</span> <span class="hljs-title">Expr</span> <span class="hljs-title">Assign</span> <span class="hljs-title">MethodCall</span> <span class="hljs-title">VarDecl</span> <span class="hljs-title">MethodBlock</span> <span class="hljs-title">VarDecls</span></span><br><span class="hljs-class">%<span class="hljs-title">type</span> &lt;<span class="hljs-title">svals</span>&gt; <span class="hljs-title">comma_id_list</span> </span><br><span class="hljs-class"></span><br><span class="hljs-class">%<span class="hljs-title">nonassoc</span> <span class="hljs-title">T_ID</span></span><br><span class="hljs-class">%<span class="hljs-title">nonassoc</span> <span class="hljs-title">HIGHIER_T_ID</span></span><br><span class="hljs-class"></span><br><span class="hljs-class">%<span class="hljs-title">left</span> <span class="hljs-title">T_OR</span></span><br><span class="hljs-class">%<span class="hljs-title">left</span> <span class="hljs-title">T_AND</span></span><br><span class="hljs-class">%<span class="hljs-title">left</span> <span class="hljs-title">T_EQ</span> <span class="hljs-title">T_NEQ</span> <span class="hljs-title">T_LT</span> <span class="hljs-title">T_LEQ</span> <span class="hljs-title">T_GT</span> <span class="hljs-title">T_GEQ</span></span><br><span class="hljs-class">%<span class="hljs-title">left</span> <span class="hljs-title">T_PLUS</span> <span class="hljs-title">T_MINUS</span></span><br><span class="hljs-class">%<span class="hljs-title">left</span> <span class="hljs-title">T_MULT</span> <span class="hljs-title">T_DIV</span> <span class="hljs-title">T_MOD</span> <span class="hljs-title">T_RIGHTSHIFT</span> <span class="hljs-title">T_LEFTSHIFT</span></span><br><span class="hljs-class">%<span class="hljs-title">left</span> <span class="hljs-title">UMINUS</span></span><br><span class="hljs-class">%<span class="hljs-title">left</span> <span class="hljs-title">UNOT</span></span><br><span class="hljs-class">%%</span><br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-title">start</span>: <span class="hljs-title">program</span></span><br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-title">program</span>: <span class="hljs-title">extern_list</span> <span class="hljs-title">decafpackage</span></span><br><span class="hljs-class"></span>    &#123; <br>        ProgramAST *prog = new ProgramAST((decafStmtList *)<span class="hljs-variable">$1</span>, (PackageAST *)<span class="hljs-variable">$2</span>); <br>		<span class="hljs-keyword">if</span> (printAST) &#123;<br>			cout &lt;&lt; getString(prog) &lt;&lt; endl;<br>		&#125;<br>        delete prog;<br>    &#125;<br><br>extern_list: /* extern_list can be empty */<br>    &#123; decafStmtList *slist = new decafStmtList(); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist; &#125;<br>    | extern_list extern_stmt &#123; decafStmtList *slist = (decafStmtList *) <span class="hljs-variable">$1</span>; slist-&gt;push_back(<span class="hljs-variable">$2</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist; &#125;<br><br>extern_stmt: T_EXTERN T_FUNC T_ID T_LPAREN extern_var_list T_RPAREN return_type T_SEMICOLON<br>    &#123;<br>        VarDefAST * ast_var_def = new VarDefAST((decafStmtList *)<span class="hljs-variable">$5</span>);<br>        ExternFunctionAST * ast_extern_<span class="hljs-function"><span class="hljs-keyword">function</span> = <span class="hljs-title">new</span> <span class="hljs-title">ExternFunctionAST</span><span class="hljs-params">(*<span class="hljs-variable">$3</span>, (TypeAST * )</span>$<span class="hljs-title">7</span>, <span class="hljs-title">ast_var_def</span>);</span><br>        delete <span class="hljs-variable">$3</span>;<br>        <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = ast_extern_function;<br>    &#125;<br><br><br>extern_var_list: <br>    &#123; decafStmtList *slist = new decafStmtList(); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist;&#125;<br>    | extern_var_list T_COMMA ExternType &#123; decafStmtList * slist = (decafStmtList *)<span class="hljs-variable">$1</span>; slist-&gt;push_back(<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist; &#125;<br>    | ExternType   &#123; decafStmtList * slist = new decafStmtList(); slist-&gt;push_back(<span class="hljs-variable">$1</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist;  &#125;<br><br>ExternType: T_STRINGTYPE &#123; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = new TypeAST(<span class="hljs-variable">$1</span>); &#125; <br>        | T_INTTYPE &#123; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = new TypeAST(<span class="hljs-variable">$1</span>); &#125;<br>        | T_BOOLTYPE &#123; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = new TypeAST(<span class="hljs-variable">$1</span>); &#125;<br><br>return_type: T_VOID &#123; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = new TypeAST(<span class="hljs-variable">$1</span>);&#125;<br>    | T_BOOLTYPE &#123; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = new TypeAST(<span class="hljs-variable">$1</span>); &#125;<br>    | T_INTTYPE &#123; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = new TypeAST(<span class="hljs-variable">$1</span>); &#125;<br>    | T_STRINGTYPE &#123; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = new TypeAST(<span class="hljs-variable">$1</span>); &#125;<br><br>normal_type: <br>    T_BOOLTYPE &#123; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = new TypeAST(<span class="hljs-variable">$1</span>); &#125;<br>    | T_INTTYPE &#123; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = new TypeAST(<span class="hljs-variable">$1</span>); &#125;<br>    | T_STRINGTYPE &#123; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = new TypeAST(<span class="hljs-variable">$1</span>); &#125;<br><br>decafpackage: T_PACKAGE T_ID T_LCB field_list method_list T_RCB<br>    &#123; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = new PackageAST(*<span class="hljs-variable">$2</span>, (decafStmtList *)<span class="hljs-variable">$4</span>, (decafStmtList *)<span class="hljs-variable">$5</span>); delete <span class="hljs-variable">$2</span>; &#125;<br><br><br>field_list:<br>    &#123; decafStmtList * slist = new decafStmtList(); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist; &#125;<br>    | field_list FieldDecl &#123;<br>        decafStmtList * slist = (decafStmtList *)<span class="hljs-variable">$1</span>;<br>        decafStmtList * slist2 = (decafStmtList *)<span class="hljs-variable">$2</span>;<br>        slist2-&gt;move_to(slist);<br>        delete slist2;<br>      //  std::cout &lt;&lt; getString(slist) &lt;&lt; endl;<br>        <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist;<br>    &#125;<br><br>constant_expr: T_INTCONSTANT &#123;NumberExpr * ne = new NumberExpr(*<span class="hljs-variable">$1</span>); delete <span class="hljs-variable">$1</span>; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = ne; &#125;<br>    | T_TRUE &#123; BoolExpr * be = new BoolExpr(true); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = be;&#125;<br>    | T_FALSE &#123; BoolExpr * be = new BoolExpr(false); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = be;&#125;<br>    | T_CHARCONSTANT &#123;NumberExpr * ne = new NumberExpr(proceesCharLit(*<span class="hljs-variable">$1</span>)); delete <span class="hljs-variable">$1</span>; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = ne; &#125;<br>    | T_STRINGCONSTANT &#123; StringConstantAST * sast = new StringConstantAST(*<span class="hljs-variable">$1</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = sast; delete <span class="hljs-variable">$1</span>; &#125;<br><br>FieldDecl:<br>    T_VAR  comma_id_list normal_type T_SEMICOLON <br>    &#123;<br>        decafStmtList * slist = new decafStmtList();<br>        <span class="hljs-keyword">for</span>(std::vector&lt;std::string&gt;::iterator i = <span class="hljs-variable">$2</span>-&gt;<span class="hljs-keyword">begin</span>(); i != <span class="hljs-variable">$2</span>-&gt;<span class="hljs-keyword">end</span>() ; i++)&#123;<br>            std::string var_name = *i;<br>            VarSizeAST * sizedecl = new VarSizeAST(VAR_TYPE_SCALAR, <span class="hljs-string">&quot;1&quot;</span>);<br>            FieldDeclAST * decl = new FieldDeclAST(var_name, (TypeAST *)<span class="hljs-variable">$3</span>, sizedecl); <br>            slist-&gt;push_back( (decafAST *)decl );<br>        &#125;<br>        delete <span class="hljs-variable">$2</span>;<br>        <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist;<br>    &#125;<br>    | T_VAR  comma_id_list T_LSB T_INTCONSTANT T_RSB normal_type T_SEMICOLON <br>    &#123;<br>        decafStmtList * slist = new decafStmtList();<br>        <span class="hljs-keyword">for</span>(std::vector&lt;std::string&gt;::iterator i = <span class="hljs-variable">$2</span>-&gt;<span class="hljs-keyword">begin</span>(); i != <span class="hljs-variable">$2</span>-&gt;<span class="hljs-keyword">end</span>() ; i++)&#123;<br>            std::string var_name = *i;<br>            VarSizeAST * sizedecl = new VarSizeAST(VAR_TYPE_ARRAY, *<span class="hljs-variable">$4</span>);<br>            FieldDeclAST * decl = new FieldDeclAST(var_name, (TypeAST *)<span class="hljs-variable">$6</span>, sizedecl); <br>            slist-&gt;push_back( (decafAST *)decl );   <br>        &#125;<br>        delete <span class="hljs-variable">$2</span>;<br>        delete <span class="hljs-variable">$4</span>;<br>        <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist;<br>    &#125;<br>    | T_VAR comma_id_list normal_type T_ASSIGN constant_expr T_SEMICOLON<br>    &#123;<br>        std::vector&lt;std::string&gt; * ids = <span class="hljs-variable">$2</span>;<br>        <span class="hljs-keyword">if</span>( ids-&gt;size() == <span class="hljs-number">1</span>)&#123;<br>            decafStmtList * slist = new decafStmtList();<br>            AssignGlobalVar * assign = new AssignGlobalVar(*ids-&gt;<span class="hljs-keyword">begin</span>(), (TypeAST *)<span class="hljs-variable">$3</span>, (ValueExpr *) <span class="hljs-variable">$5</span>);<br>            delete <span class="hljs-variable">$2</span>;<br>            slist-&gt;push_back(assign);<br>            <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            printf(<span class="hljs-string">&quot;error\n&quot;</span>);<br>            //<span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);<br>            YYABORT;<br>        &#125;<br><br>    &#125;<br><br>VarDecl:<br>    T_VAR  comma_id_list normal_type T_SEMICOLON <br>    &#123;<br>        decafStmtList * slist = new decafStmtList();<br>        <span class="hljs-keyword">for</span>(std::vector&lt;std::string&gt;::iterator i = <span class="hljs-variable">$2</span>-&gt;<span class="hljs-keyword">begin</span>(); i != <span class="hljs-variable">$2</span>-&gt;<span class="hljs-keyword">end</span>() ; i++)&#123;<br>            std::string var_name = *i;<br>            VarDefAST * decl = new VarDefAST(var_name, (TypeAST *)<span class="hljs-variable">$3</span>); <br>            slist-&gt;push_back( (decafAST *)decl );<br>        &#125;<br>        delete <span class="hljs-variable">$2</span>;<br>        <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist;<br>    &#125;<br>    | T_VAR  comma_id_list T_LSB T_INTCONSTANT T_RSB normal_type T_SEMICOLON <br>    &#123;<br>        decafStmtList * slist = new decafStmtList();<br>        <span class="hljs-keyword">for</span>(std::vector&lt;std::string&gt;::iterator i = <span class="hljs-variable">$2</span>-&gt;<span class="hljs-keyword">begin</span>(); i != <span class="hljs-variable">$2</span>-&gt;<span class="hljs-keyword">end</span>() ; i++)&#123;<br>            std::string var_name = *i;<br>            VarDefAST * decl = new VarDefAST(var_name, (TypeAST *)<span class="hljs-variable">$6</span>); <br>            slist-&gt;push_back( (decafAST *)decl );   <br>        &#125;<br>        delete <span class="hljs-variable">$2</span>;<br>        delete <span class="hljs-variable">$4</span>;<br>        <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist;<br>    &#125;<br><br>VarDecls:<br>    &#123; decafStmtList * slist = new decafStmtList(); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist; &#125;<br>    | VarDecls VarDecl &#123;<br>        decafStmtList * slist = (decafStmtList *)<span class="hljs-variable">$1</span>;<br>        decafStmtList * slist2 = (decafStmtList *)<span class="hljs-variable">$2</span>;<br>        slist2-&gt;move_to(slist);<br>        delete slist2;<br>       // std::cout &lt;&lt; getString(slist) &lt;&lt; endl;<br>        <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist;<br>    &#125;<br><br>comma_id_list: comma_id_list T_COMMA T_ID  &#123; std::vector&lt;std::string&gt; * ids = <span class="hljs-variable">$1</span>; ids-&gt;push_back(*<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = ids; delete <span class="hljs-variable">$3</span>; &#125; <br>    | T_ID  &#123; std::vector&lt;std::string&gt;  * ids = new std::vector&lt;std::string&gt;(); ids-&gt;push_back(*<span class="hljs-variable">$1</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = ids; delete <span class="hljs-variable">$1</span>;&#125; <br><br>method_list: &#123;decafStmtList * slist = new decafStmtList(); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist; &#125;<br>    | method_list MethodDecl &#123; decafStmtList * slist = (decafStmtList *)<span class="hljs-variable">$1</span>; slist-&gt;push_back(<span class="hljs-variable">$2</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = <span class="hljs-variable">$1</span>;&#125;<br>    <br>typed_var_defs:<br>    &#123; decafStmtList* slist = new decafStmtList(); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist; &#125;<br>    | typed_var_defs T_COMMA T_ID normal_type &#123; decafStmtList * slist = (decafStmtList *)<span class="hljs-variable">$1</span>; VarDefAST * def = new VarDefAST(*<span class="hljs-variable">$3</span>, ( TypeAST *)<span class="hljs-variable">$4</span>); slist-&gt;push_back(def); delete <span class="hljs-variable">$3</span>; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = <span class="hljs-variable">$1</span>;&#125;<br>    | T_ID normal_type &#123; decafStmtList* slist = new decafStmtList(); VarDefAST * def = new VarDefAST(*<span class="hljs-variable">$1</span>, ( TypeAST *)<span class="hljs-variable">$2</span>); slist-&gt;push_back(def); delete <span class="hljs-variable">$1</span>; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist;   &#125;<br><br>MethodDecl: T_FUNC T_ID T_LPAREN typed_var_defs T_RPAREN return_type MethodBlock<br>    &#123;<br>        MethodAST * method_decl = new MethodAST(*<span class="hljs-variable">$2</span>, (TypeAST *)<span class="hljs-variable">$6</span>, (decafStmtList *)<span class="hljs-variable">$4</span>, (MethodBlockAST *)<span class="hljs-variable">$7</span>);<br>        delete <span class="hljs-variable">$2</span>;<br>        <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = method_decl;<br>    &#125;<br><br>MethodBlock: T_LCB VarDecls Statements T_RCB <br>    &#123;<br>        MethodBlockAST * block = new MethodBlockAST((decafStmtList *)<span class="hljs-variable">$2</span>, (decafStmtList *)<span class="hljs-variable">$3</span>);<br>        <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = block;<br>    &#125;<br><br>Block: T_LCB VarDecls Statements T_RCB <br>    &#123;<br>        BlockAST * block = new BlockAST((decafStmtList *)<span class="hljs-variable">$2</span>, (decafStmtList *)<span class="hljs-variable">$3</span>);<br>        <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = block;<br>    &#125;<br>  <br>Statements: &#123;decafStmtList * slist = new decafStmtList(); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist;&#125;<br>    | Statements Statement &#123; decafStmtList * slist = (decafStmtList *)<span class="hljs-variable">$1</span>; slist-&gt;push_back(<span class="hljs-variable">$2</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist; &#125;<br><br>ElseBlock:<br>    &#123; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = nullptr; &#125;<br>    | T_ELSE Block &#123; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = <span class="hljs-variable">$2</span>; &#125;<br><br>Statement: Block &#123; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = <span class="hljs-variable">$1</span>; &#125;<br>    | Assign T_SEMICOLON &#123; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = <span class="hljs-variable">$1</span>; &#125;<br>    | MethodCall T_SEMICOLON &#123; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = <span class="hljs-variable">$1</span>; &#125;<br>    | T_IF T_LPAREN Expr T_RPAREN Block ElseBlock &#123; IfStmtAST * ifast = new IfStmtAST((ExprAST *)<span class="hljs-variable">$3</span>, (BlockAST *)<span class="hljs-variable">$5</span>, (BlockAST *)<span class="hljs-variable">$6</span> );<span class="hljs-variable">$</span><span class="hljs-variable">$</span> = ifast; &#125;<br>    | T_WHILE T_LPAREN Expr T_RPAREN Block &#123; WhileStmtAST * whileast = new WhileStmtAST((ExprAST *)<span class="hljs-variable">$3</span>, (BlockAST *)<span class="hljs-variable">$5</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = whileast; &#125;<br>    | T_FOR T_LPAREN ForAssignList T_SEMICOLON Expr T_SEMICOLON ForAssignList T_RPAREN Block &#123; ForStmtAST * forast = new ForStmtAST((decafStmtList *)<span class="hljs-variable">$3</span>, (ExprAST *)<span class="hljs-variable">$5</span>, (decafStmtList *)<span class="hljs-variable">$7</span>, (BlockAST *)<span class="hljs-variable">$9</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = forast; &#125;<br>    | T_RETURN T_LPAREN Expr T_RPAREN  T_SEMICOLON &#123; ReturnStmtAST * returnast = new ReturnStmtAST((ExprAST *)<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = returnast; &#125;<br>    | T_RETURN T_LPAREN T_RPAREN T_SEMICOLON &#123;ReturnStmtAST * returnast = new ReturnStmtAST(nullptr); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = returnast; &#125;<br>    | T_RETURN T_SEMICOLON &#123; ReturnStmtAST * returnast = new ReturnStmtAST(nullptr); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = returnast; &#125;<br>    | T_BREAK T_SEMICOLON &#123; BreakStmtAST * breakast = new BreakStmtAST(); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = breakast; &#125;<br>    | T_CONTINUE T_SEMICOLON &#123; ContinueStmtAST * cntast = new ContinueStmtAST(); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = cntast; &#125;<br><br>Assign: <br>    T_ID T_ASSIGN Expr<br>        &#123;<br>            AssignVarAST * assign = new AssignVarAST(*<span class="hljs-variable">$1</span>, (ExprAST *)<span class="hljs-variable">$3</span>);<br>            delete <span class="hljs-variable">$1</span>;<br>            <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = assign;<br>        &#125;<br>    | T_ID T_LSB Expr T_RSB T_ASSIGN Expr<br>        &#123;<br>            AssignArrayLocAST * arr_loc = new AssignArrayLocAST(*<span class="hljs-variable">$1</span>, (ExprAST *)<span class="hljs-variable">$3</span>, (ExprAST *)<span class="hljs-variable">$6</span>);<br>            delete <span class="hljs-variable">$1</span>;<br>            <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = arr_loc;<br>        &#125;<br><br>MethodArg: Expr &#123; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = <span class="hljs-variable">$1</span>;&#125;<br><br>MethodArgList: &#123; decafStmtList * slist = new decafStmtList(); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist; &#125;<br>    | MethodArgList T_COMMA MethodArg &#123;decafStmtList * slist = (decafStmtList *)<span class="hljs-variable">$1</span>; slist-&gt;push_back(<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = <span class="hljs-variable">$1</span>;&#125;<br>    | MethodArg &#123; decafStmtList * slist = new decafStmtList(); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist; slist-&gt;push_back(<span class="hljs-variable">$1</span>); &#125; <br><br>MethodCall: T_ID T_LPAREN MethodArgList T_RPAREN<br>    &#123;<br>        MethodCallAST * call = new MethodCallAST(*<span class="hljs-variable">$1</span>, (decafStmtList *)<span class="hljs-variable">$3</span>); <br>        <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = call;<br>        delete <span class="hljs-variable">$1</span>;<br>    &#125;<br><br>Expr:<br>    T_ID &#123; VariableExprAST * var_exp = new VariableExprAST(*<span class="hljs-variable">$1</span>); delete <span class="hljs-variable">$1</span>; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = var_exp; &#125;<br>    | MethodCall &#123; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = <span class="hljs-variable">$1</span>; &#125;<br>    | constant_expr &#123; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = <span class="hljs-variable">$1</span>; &#125;<br>    | T_LPAREN Expr T_RPAREN &#123; <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = <span class="hljs-variable">$2</span> &#125;<br>    | T_ID T_LSB Expr T_RSB &#123;  ArrayLocExprAST * arr = new ArrayLocExprAST(*<span class="hljs-variable">$1</span>, (ExprAST *)<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = arr; delete <span class="hljs-variable">$1</span>; &#125;<br>    | Expr T_PLUS Expr &#123; BinaryExprAST * binexp = new BinaryExprAST(<span class="hljs-string">&quot;Plus&quot;</span>, (ExprAST *)<span class="hljs-variable">$1</span>, (ExprAST *)<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = binexp; &#125;<br>    | Expr T_MINUS Expr &#123;BinaryExprAST * binexp = new BinaryExprAST(<span class="hljs-string">&quot;Minus&quot;</span>, (ExprAST *)<span class="hljs-variable">$1</span>, (ExprAST *)<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = binexp; &#125;<br>    | Expr T_MULT Expr &#123; BinaryExprAST * binexp = new BinaryExprAST(<span class="hljs-string">&quot;Mult&quot;</span>, (ExprAST *)<span class="hljs-variable">$1</span>, (ExprAST *)<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = binexp; &#125;<br>    | Expr T_DIV Expr &#123; BinaryExprAST * binexp = new BinaryExprAST(<span class="hljs-string">&quot;Div&quot;</span>, (ExprAST *)<span class="hljs-variable">$1</span>, (ExprAST *)<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = binexp; &#125;<br>    | Expr T_LEFTSHIFT Expr &#123; BinaryExprAST * binexp = new BinaryExprAST(<span class="hljs-string">&quot;Leftshift&quot;</span>, (ExprAST *)<span class="hljs-variable">$1</span>, (ExprAST *)<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = binexp; &#125;<br>    | Expr T_RIGHTSHIFT Expr &#123; BinaryExprAST * binexp = new BinaryExprAST(<span class="hljs-string">&quot;Rightshift&quot;</span>, (ExprAST *)<span class="hljs-variable">$1</span>, (ExprAST *)<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = binexp; &#125;<br>    | Expr T_MOD Expr &#123; BinaryExprAST * binexp = new BinaryExprAST(<span class="hljs-string">&quot;Mod&quot;</span>, (ExprAST *)<span class="hljs-variable">$1</span>, (ExprAST *)<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = binexp; &#125;<br>    | Expr T_LT Expr &#123; BinaryExprAST * binexp = new BinaryExprAST(<span class="hljs-string">&quot;Lt&quot;</span>, (ExprAST *)<span class="hljs-variable">$1</span>, (ExprAST *)<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = binexp; &#125;<br>    | Expr T_GT Expr &#123; BinaryExprAST * binexp = new BinaryExprAST(<span class="hljs-string">&quot;Gt&quot;</span>, (ExprAST *)<span class="hljs-variable">$1</span>, (ExprAST *)<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = binexp; &#125;<br>    | Expr T_LEQ Expr &#123; BinaryExprAST * binexp = new BinaryExprAST(<span class="hljs-string">&quot;Leq&quot;</span>, (ExprAST *)<span class="hljs-variable">$1</span>, (ExprAST *)<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = binexp; &#125;<br>    | Expr T_GEQ Expr &#123; BinaryExprAST * binexp = new BinaryExprAST(<span class="hljs-string">&quot;Geq&quot;</span>, (ExprAST *)<span class="hljs-variable">$1</span>, (ExprAST *)<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = binexp;&#125;<br>    | Expr T_EQ Expr &#123; BinaryExprAST * binexp = new BinaryExprAST(<span class="hljs-string">&quot;Eq&quot;</span>, (ExprAST *)<span class="hljs-variable">$1</span>, (ExprAST *)<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = binexp;&#125;<br>    | Expr T_NEQ Expr &#123; BinaryExprAST * binexp = new BinaryExprAST(<span class="hljs-string">&quot;Neq&quot;</span>, (ExprAST *)<span class="hljs-variable">$1</span>, (ExprAST *)<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = binexp;&#125;<br>    | Expr T_AND Expr &#123; BinaryExprAST * binexp = new BinaryExprAST(<span class="hljs-string">&quot;And&quot;</span>, (ExprAST *)<span class="hljs-variable">$1</span>, (ExprAST *)<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = binexp;&#125;<br>    | Expr T_OR Expr &#123; BinaryExprAST * binexp = new BinaryExprAST(<span class="hljs-string">&quot;Or&quot;</span>, (ExprAST *)<span class="hljs-variable">$1</span>, (ExprAST *)<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = binexp;&#125;<br>    | T_MINUS Expr %prec UMINUS &#123; UnaryExprAST * unary = new UnaryExprAST(<span class="hljs-string">&quot;UnaryMinus&quot;</span>, (ExprAST *)<span class="hljs-variable">$2</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = unary;&#125;<br>    | T_NOT Expr %prec UNOT &#123; UnaryExprAST * unary = new UnaryExprAST(<span class="hljs-string">&quot;Not&quot;</span>, (ExprAST *)<span class="hljs-variable">$2</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = unary;&#125;<br><br><br>ForAssignList: /* &#123; Assign &#125;+, */<br>    &#123; decafStmtList * slist = new decafStmtList(); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist&#125;<br>    | ForAssignList T_COMMA Assign &#123; decafStmtList * slist = (decafStmtList *)<span class="hljs-variable">$1</span>; slist-&gt;push_back(<span class="hljs-variable">$3</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist; &#125;<br>    | Assign &#123; decafStmtList * slist = new decafStmtList(); slist-&gt;push_back(<span class="hljs-variable">$1</span>); <span class="hljs-variable">$</span><span class="hljs-variable">$</span> = slist; &#125;<br><br><br>%%<br><br>int main() &#123;<br>  // parse the input and create the abstract syntax tree<br>  int retval = yyparse();<br>  <span class="hljs-keyword">return</span>(retval &gt;= <span class="hljs-number">1</span> ? EXIT_FAILURE : EXIT_SUCCESS);<br>&#125;<br><br><br></code></pre></td></tr></table></figure>
<h3 id="decafast-cc"><a href="#decafast-cc" class="headerlink" title="decafast.cc"></a>decafast.cc</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br></pre></td><td class="code"><pre><code class="hljs c++"><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;default-defs.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;list&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sstream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> YYTOKENTYPE</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;decafast.tab.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<br><br><span class="hljs-comment">/// decafAST - Base class for all abstract syntax tree nodes.</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">decafAST</span> &#123;</span><br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-keyword">virtual</span> ~decafAST() &#123;&#125;<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;&quot;</span>); &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">getString</span><span class="hljs-params">(decafAST *d)</span> </span>&#123;<br>	<span class="hljs-keyword">if</span> (d != <span class="hljs-literal">NULL</span>) &#123;<br>		<span class="hljs-keyword">return</span> d-&gt;str();<br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;None&quot;</span>);<br>	&#125;<br>&#125;<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T</span>&gt;</span><br><span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">commaList</span><span class="hljs-params">(<span class="hljs-built_in">list</span>&lt;T&gt; vec)</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">s</span><span class="hljs-params">(<span class="hljs-string">&quot;&quot;</span>)</span></span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">typename</span> <span class="hljs-built_in">list</span>&lt;T&gt;::iterator i = vec.begin(); i != vec.end(); i++) &#123; <br>        s = s + (s.empty() ? <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;&quot;</span>) : <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;,&quot;</span>)) + (*i)-&gt;str(); <br>    &#125;   <br>    <span class="hljs-keyword">if</span> (s.empty()) &#123;<br>        s = <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;None&quot;</span>);<br>    &#125;   <br>    <span class="hljs-keyword">return</span> s;<br>&#125;<br><br><span class="hljs-comment">/// decafStmtList - List of Decaf statements</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">decafStmtList</span> :</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	<span class="hljs-built_in">list</span>&lt;decafAST *&gt; stmts;<br><span class="hljs-keyword">public</span>:<br>	decafStmtList() &#123;&#125;<br>	~decafStmtList() &#123;<br>		<span class="hljs-keyword">for</span> (<span class="hljs-built_in">list</span>&lt;decafAST *&gt;::iterator i = stmts.begin(); i != stmts.end(); i++) &#123; <br>			<span class="hljs-keyword">delete</span> *i;<br>		&#125;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">size</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> stmts.size(); &#125;<br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">push_front</span><span class="hljs-params">(decafAST *e)</span> </span>&#123; stmts.push_front(e); &#125;<br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">push_back</span><span class="hljs-params">(decafAST *e)</span> </span>&#123; stmts.push_back(e); &#125;<br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">move_to</span><span class="hljs-params">(decafStmtList * target)</span></span>&#123;<br>		assert( target != <span class="hljs-literal">NULL</span> );<br>		<span class="hljs-keyword">for</span>( <span class="hljs-built_in">list</span>&lt;decafAST *&gt;::iterator i = stmts.begin(); i != stmts.end(); i++) &#123;<br>			target-&gt;push_back( *i );<br>		&#125;<br>		stmts.clear();<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> commaList&lt;class decafAST *&gt;(stmts); &#125;<br>&#125;;<br><br><span class="hljs-comment">// package = Package(identifier name, field_decl* field_list, method_decl* method_list)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PackageAST</span> :</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	<span class="hljs-built_in">string</span> Name;<br>	decafStmtList *FieldDeclList;<br>	decafStmtList *MethodDeclList;<br><span class="hljs-keyword">public</span>:<br>	PackageAST(<span class="hljs-built_in">string</span> name, decafStmtList *fieldlist, decafStmtList *methodlist) <br>		: Name(name), FieldDeclList(fieldlist), MethodDeclList(methodlist) &#123;&#125;<br>	~PackageAST() &#123; <br>		<span class="hljs-keyword">if</span> (FieldDeclList != <span class="hljs-literal">NULL</span>) &#123; <span class="hljs-keyword">delete</span> FieldDeclList; &#125;<br>		<span class="hljs-keyword">if</span> (MethodDeclList != <span class="hljs-literal">NULL</span>) &#123; <span class="hljs-keyword">delete</span> MethodDeclList; &#125;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123; <br>		<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;Package&quot;</span>) + <span class="hljs-string">&quot;(&quot;</span> + Name + <span class="hljs-string">&quot;,&quot;</span> + getString(FieldDeclList) + <span class="hljs-string">&quot;,&quot;</span> + getString(MethodDeclList) + <span class="hljs-string">&quot;)&quot;</span>;<br>	&#125;<br>&#125;;<br><br><span class="hljs-comment">/// ProgramAST - the decaf program</span><br><span class="hljs-comment">// prog = Program(extern* extern_list, package body)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProgramAST</span> :</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	decafStmtList *ExternList;<br>	PackageAST *PackageDef;<br><span class="hljs-keyword">public</span>:<br>	ProgramAST(decafStmtList *externs, PackageAST *c) : ExternList(externs), PackageDef(c) &#123;&#125;<br>	~ProgramAST() &#123; <br>		<span class="hljs-keyword">if</span> (ExternList != <span class="hljs-literal">NULL</span>) &#123; <span class="hljs-keyword">delete</span> ExternList; &#125; <br>		<span class="hljs-keyword">if</span> (PackageDef != <span class="hljs-literal">NULL</span>) &#123; <span class="hljs-keyword">delete</span> PackageDef; &#125;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;Program&quot;</span>) + <span class="hljs-string">&quot;(&quot;</span> + getString(ExternList) + <span class="hljs-string">&quot;,&quot;</span> + getString(PackageDef) + <span class="hljs-string">&quot;)&quot;</span>; &#125;<br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TypeAST</span> :</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	<span class="hljs-built_in">string</span> * Name;<br><br><span class="hljs-keyword">public</span>:<br>	TypeAST(<span class="hljs-built_in">string</span> * name): Name(name) &#123;&#125;;<br>	~TypeAST() &#123; <span class="hljs-keyword">if</span>(Name) <span class="hljs-keyword">delete</span> Name; &#125;;<br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(*Name);<br>	&#125;	<br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VarDefAST</span> :</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	<span class="hljs-built_in">string</span> Name;<br>	decafStmtList * TypeList;<br><br>	<span class="hljs-keyword">public</span>:<br>		VarDefAST(decafStmtList * typelist): TypeList(typelist) &#123;&#125;<br>		VarDefAST(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name, TypeAST * type ) &#123;<br>			decafStmtList * typelist = <span class="hljs-keyword">new</span> decafStmtList();<br>			typelist-&gt;push_back(type);<br>			TypeList = typelist;<br>			Name = name;<br>		&#125;;	<br><br>		~VarDefAST() &#123;<br>			<span class="hljs-keyword">if</span>( TypeList ) <span class="hljs-keyword">delete</span> TypeList;<br>		&#125;<br><br><br>		<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span></span>&#123;<br>			<span class="hljs-keyword">if</span> (TypeList-&gt;size() == <span class="hljs-number">0</span>)<br>				<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;None&quot;</span>);<br>			<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(TypeList-&gt;size() == <span class="hljs-number">1</span> &amp;&amp; Name != <span class="hljs-string">&quot;&quot;</span>)<br>				<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;VarDef(&quot;</span>) + Name + <span class="hljs-string">&quot;,&quot;</span> + getString(TypeList) + <span class="hljs-string">&quot;)&quot;</span>;<br>			<span class="hljs-keyword">else</span><br>				<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;VarDef(&quot;</span>) + getString(TypeList) + <span class="hljs-string">&quot;)&quot;</span>;<br>		&#125;<br>&#125;;<br><br><br><br><br><span class="hljs-comment">// ExternFunction(identifier name, method_type return_type, extern_type* typelist)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExternFunctionAST</span> :</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	<span class="hljs-built_in">string</span> Name;<br>	TypeAST * ReturnType;<br>	VarDefAST * VarList;<br><br><span class="hljs-keyword">public</span>:<br>	ExternFunctionAST(<span class="hljs-built_in">string</span> name, TypeAST * returntype, VarDefAST * varlist): Name(name), ReturnType(returntype), VarList(varlist) &#123;&#125;<br>	~ExternFunctionAST() &#123;<br>		<span class="hljs-keyword">if</span>( VarList ) <span class="hljs-keyword">delete</span> VarList;<br>		<span class="hljs-keyword">if</span>( ReturnType ) <span class="hljs-keyword">delete</span> ReturnType;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;ExternFunction&quot;</span>)  + <span class="hljs-string">&quot;(&quot;</span> + Name + <span class="hljs-string">&quot;,&quot;</span> + ReturnType-&gt;str() + <span class="hljs-string">&quot;,&quot;</span> + getString(VarList) + <span class="hljs-string">&quot;)&quot;</span>;<br>	&#125;<br>&#125;;<br><br><span class="hljs-comment">// field_size = Scalar | Array(int array_size)</span><br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">VAR_TYPE</span> &#123;</span> VAR_TYPE_SCALAR, VAR_TYPE_ARRAY &#125;;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VarSizeAST</span> :</span> <span class="hljs-keyword">public</span> decafAST &#123;<br><span class="hljs-keyword">private</span>:<br>	VAR_TYPE VarType;<br>	<span class="hljs-built_in">string</span> Size;<br><span class="hljs-keyword">public</span>:<br>	VarSizeAST(VAR_TYPE type, <span class="hljs-built_in">string</span> size): VarType(type), Size(size) &#123;&#125;;<br><br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">if</span>( VarType == VAR_TYPE_SCALAR)<br>			<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;Scalar&quot;</span>);<br>		<span class="hljs-keyword">else</span><br>			<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;Array(&quot;</span>) + Size + <span class="hljs-string">&quot;)&quot;</span>;<br>	&#125; <br>&#125;;<br><br><span class="hljs-comment">// FieldDecl(identifier name, decaf_type type, field_size size)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FieldDeclAST</span> :</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	<span class="hljs-built_in">string</span> Name;<br>	TypeAST * Type;<br>	VarSizeAST * field_size;<br><br><span class="hljs-keyword">public</span>:<br>	FieldDeclAST(<span class="hljs-built_in">string</span> name, TypeAST * type, VarSizeAST * size): Name(name), Type(type), field_size(size) &#123; &#125;;<br>	~FieldDeclAST() &#123; <span class="hljs-keyword">if</span> (Type) <span class="hljs-keyword">delete</span> Type; <span class="hljs-keyword">if</span>(field_size) <span class="hljs-keyword">delete</span> field_size;&#125;;<br><br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span></span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;FieldDecl(&quot;</span>) + Name + <span class="hljs-string">&quot;,&quot;</span> + getString(Type) + <span class="hljs-string">&quot;,&quot;</span> + getString(field_size) + <span class="hljs-string">&quot;)&quot;</span>;  <br>	&#125;<br><br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringConstantAST</span>:</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	<span class="hljs-built_in">string</span> Value;<br>	<span class="hljs-keyword">public</span>:<br>	StringConstantAST(<span class="hljs-built_in">string</span> v): Value(v) &#123;&#125;;<br>	~StringConstantAST() &#123;&#125;;<br><br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;StringConstant(&quot;</span>) + Value + <span class="hljs-string">&quot;)&quot;</span>;<br>	&#125;<br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ValueExpr</span> :</span> <span class="hljs-keyword">public</span> decafAST &#123;&#125;;<br><br><span class="hljs-comment">// NumberExpr(int value)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NumberExpr</span> :</span> <span class="hljs-keyword">public</span> ValueExpr &#123;<br>	<span class="hljs-built_in">string</span> Value;<br><br>	<span class="hljs-keyword">public</span>:<br>		NumberExpr(<span class="hljs-built_in">string</span> value): Value(value) &#123; &#125;;<br>		~NumberExpr() &#123;&#125;;<br>		<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>			<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;NumberExpr(&quot;</span>) + Value + <span class="hljs-string">&quot;)&quot;</span>;<br>		&#125;<br>&#125;;<br><br><span class="hljs-comment">// BoolExpr(bool value)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BoolExpr</span> :</span> <span class="hljs-keyword">public</span> ValueExpr &#123;<br>	<span class="hljs-keyword">bool</span> Value;<br>	<br><span class="hljs-keyword">public</span>:<br>	BoolExpr(<span class="hljs-keyword">bool</span> value): Value(value) &#123;&#125;;<br>	~BoolExpr() &#123;&#125;;<br><br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;BoolExpr(&quot;</span>) + ( Value ? <span class="hljs-string">&quot;True&quot;</span>:<span class="hljs-string">&quot;False&quot;</span> ) + <span class="hljs-string">&quot;)&quot;</span>;<br>	&#125;<br>&#125;;<br><br><br><span class="hljs-comment">// AssignGlobalVar(identifier name, decaf_type type, constant value)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AssignGlobalVar</span> :</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	<span class="hljs-built_in">string</span> Name;<br>	TypeAST * Type;<br>	ValueExpr * Value;<br><br>	<span class="hljs-keyword">public</span>:<br>		AssignGlobalVar(<span class="hljs-built_in">string</span> name, TypeAST * type,ValueExpr * value): Name(name), Type(type), Value(value) &#123;&#125; ;<br>		~AssignGlobalVar() &#123;<br>			<span class="hljs-keyword">if</span> ( Type ) <span class="hljs-keyword">delete</span> Type;<br>			<span class="hljs-keyword">if</span> ( Value ) <span class="hljs-keyword">delete</span> Value;<br>		&#125;<br>	<br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;AssignGlobalVar(&quot;</span>) + Name + <span class="hljs-string">&quot;,&quot;</span> + getString(Type) + <span class="hljs-string">&quot;,&quot;</span> + getString(Value) + <span class="hljs-string">&quot;)&quot;</span>;<br>	&#125;<br>&#125;;<br><br><span class="hljs-comment">// MethodBlock(typed_symbol* var_decl_list, statement* statement_list)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MethodBlockAST</span>:</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	decafStmtList * VarDeclList;<br>	decafStmtList * StatementList;<br><br>	<span class="hljs-keyword">public</span>:<br>		MethodBlockAST(decafStmtList* var_decl_list, decafStmtList * statement_list): VarDeclList(var_decl_list), StatementList(statement_list) &#123;&#125;<br>		~MethodBlockAST()&#123;<br>			<span class="hljs-keyword">if</span>( VarDeclList ) <span class="hljs-keyword">delete</span> VarDeclList;<br>			<span class="hljs-keyword">if</span>( StatementList ) <span class="hljs-keyword">delete</span> StatementList;<br>		&#125;<br><br>		<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>			<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;MethodBlock(&quot;</span>) + getString(VarDeclList)+<span class="hljs-string">&quot;,&quot;</span> + getString(StatementList) + <span class="hljs-string">&quot;)&quot;</span>;<br>		&#125;<br>&#125;;<br><br><span class="hljs-comment">// Block(typed_symbol* var_decl_list, statement* statement_list)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BlockAST</span>:</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	decafStmtList * VarDeclList;<br>	decafStmtList * StatementList;<br><br>	<span class="hljs-keyword">public</span>:<br>		BlockAST(decafStmtList* var_decl_list, decafStmtList * statement_list): VarDeclList(var_decl_list), StatementList(statement_list) &#123;&#125;<br>		~BlockAST()&#123;<br>			<span class="hljs-keyword">if</span>( VarDeclList ) <span class="hljs-keyword">delete</span> VarDeclList;<br>			<span class="hljs-keyword">if</span>( StatementList ) <span class="hljs-keyword">delete</span> StatementList;<br>		&#125;<br><br>		<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>			<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;Block(&quot;</span>) + getString(VarDeclList)+<span class="hljs-string">&quot;,&quot;</span> + getString(StatementList) + <span class="hljs-string">&quot;)&quot;</span>;<br>		&#125;<br>&#125;;<br><br><span class="hljs-comment">// Method(identifier name, method_type return_type, typed_symbol* param_list, method_block block)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MethodAST</span> :</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	<span class="hljs-built_in">string</span> Name;<br>	TypeAST *  ReturnType;<br>	decafStmtList * ParamList; <span class="hljs-comment">// VarDefAST*</span><br>	MethodBlockAST * Block;<br><br>	<span class="hljs-keyword">public</span>:<br>		MethodAST(<span class="hljs-built_in">string</span> name, TypeAST * return_type, decafStmtList * param_list, MethodBlockAST * block): <br>			Name(name), ReturnType(return_type), ParamList(param_list), Block(block) &#123;&#125;;<br><br>		~MethodAST()&#123;<br>			<span class="hljs-keyword">if</span>( ReturnType ) <span class="hljs-keyword">delete</span> ReturnType;<br>			<span class="hljs-keyword">if</span>( ParamList ) <span class="hljs-keyword">delete</span> ParamList;<br>			<span class="hljs-keyword">if</span>( Block ) <span class="hljs-keyword">delete</span> Block;<br>		&#125;<br><br>		<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>			<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;Method(&quot;</span>) + Name + <span class="hljs-string">&quot;,&quot;</span> + getString(ReturnType) + <span class="hljs-string">&quot;,&quot;</span> + getString(ParamList) + <span class="hljs-string">&quot;,&quot;</span> + getString(Block) + <span class="hljs-string">&quot;)&quot;</span>;<br>		&#125;<br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExprAST</span>:</span> <span class="hljs-keyword">public</span> decafAST &#123;&#125;;<br><br><span class="hljs-comment">// AssignArrayLoc(identifier name, expr index, expr value)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AssignArrayLocAST</span> :</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	<span class="hljs-built_in">string</span> Name;<br>	ExprAST * IndexExpr;<br>	ExprAST * ValueExpr;<br><br>	<span class="hljs-keyword">public</span>:<br>	AssignArrayLocAST(<span class="hljs-built_in">string</span> name, ExprAST * index, ExprAST * value): Name(name), IndexExpr(index), ValueExpr(value) &#123;&#125;;<br>	~AssignArrayLocAST() &#123;<br>		<span class="hljs-keyword">if</span> ( IndexExpr ) <span class="hljs-keyword">delete</span> IndexExpr;<br>		<span class="hljs-keyword">if</span> ( ValueExpr ) <span class="hljs-keyword">delete</span> ValueExpr;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;AssignArrayLoc(&quot;</span>) + Name + <span class="hljs-string">&quot;,&quot;</span> + getString(IndexExpr) + <span class="hljs-string">&quot;,&quot;</span> + getString(ValueExpr) + <span class="hljs-string">&quot;)&quot;</span>;<br>	&#125;<br>&#125;;<br><br><span class="hljs-comment">// AssignVar(identifier name, expr value)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AssignVarAST</span>:</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	<span class="hljs-built_in">string</span> Name;<br>	ExprAST * Expr;<br><br><span class="hljs-keyword">public</span>:<br>	AssignVarAST(<span class="hljs-built_in">string</span> name, ExprAST * expr): Name(name), Expr(expr) &#123;&#125;;<br>	~AssignVarAST() &#123;<br>		<span class="hljs-keyword">if</span>( Expr ) <span class="hljs-keyword">delete</span> Expr;<br>	&#125;;<br><br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;AssignVar(&quot;</span>) + Name + <span class="hljs-string">&quot;,&quot;</span> + getString(Expr) + <span class="hljs-string">&quot;)&quot;</span>;<br>	&#125;<br>&#125;;<br><br><span class="hljs-comment">// rvalue = VariableExpr(identifier name)</span><br><span class="hljs-comment">//     | ArrayLocExpr(identifier name, expr index)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VariableExprAST</span>:</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	<span class="hljs-built_in">string</span> Id;<br><span class="hljs-keyword">public</span>:<br>	VariableExprAST(<span class="hljs-built_in">string</span> id): Id(id) &#123;&#125;;<br>	~VariableExprAST() &#123;&#125;;<br><br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;VariableExpr(&quot;</span>) + Id + <span class="hljs-string">&quot;)&quot;</span>;<br>	&#125;<br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ArrayLocExprAST</span>:</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	<span class="hljs-built_in">string</span> Id;<br>	ExprAST * IndexExpr;<br><br><span class="hljs-keyword">public</span>:<br>	ArrayLocExprAST(<span class="hljs-built_in">string</span> id, ExprAST * expr): Id(id), IndexExpr(expr) &#123;&#125;;<br>	~ArrayLocExprAST() &#123;<br>		<span class="hljs-keyword">if</span>( IndexExpr ) <span class="hljs-keyword">delete</span> IndexExpr;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;ArrayLocExpr(&quot;</span>) + Id + <span class="hljs-string">&quot;,&quot;</span> + getString(IndexExpr) + <span class="hljs-string">&quot;)&quot;</span>;<br>	&#125;<br><br>&#125;;<br><br><span class="hljs-comment">// MethodCall(identifier name, method_arg* method_arg_list)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MethodCallAST</span>:</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	<span class="hljs-built_in">string</span> Name;<br>	decafStmtList * MethodArgList;<br><span class="hljs-keyword">public</span>:<br>	MethodCallAST(<span class="hljs-built_in">string</span> name, decafStmtList * method_arg_list): Name(name), MethodArgList(method_arg_list) &#123;&#125;;<br>	~MethodCallAST() &#123;<br>		<span class="hljs-keyword">if</span> ( MethodArgList ) <span class="hljs-keyword">delete</span> MethodArgList;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;MethodCall(&quot;</span>) + Name + <span class="hljs-string">&quot;,&quot;</span> + getString(MethodArgList) + <span class="hljs-string">&quot;)&quot;</span>;<br>	&#125;<br>&#125;;<br><br><span class="hljs-comment">// BinaryExpr(binary_operator op, expr left_value, expr right_value)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BinaryExprAST</span>:</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	<span class="hljs-built_in">string</span> Op; <span class="hljs-comment">// &#123;Plus , Minus , Mult , Div , Leftshift , Rightshift , Mod , Lt , Gt , Leq , Geq , Eq , Neq , And , Or&#125;;</span><br>	ExprAST * LeftExpr;<br>	ExprAST * RightExpr;<br><br>	<span class="hljs-keyword">public</span>:<br>	BinaryExprAST(<span class="hljs-built_in">string</span> op, ExprAST * left, ExprAST * right): Op(op), LeftExpr(left), RightExpr(right) &#123;&#125;;<br>	~BinaryExprAST() &#123;<br>		<span class="hljs-keyword">if</span> ( LeftExpr ) <span class="hljs-keyword">delete</span> LeftExpr;<br>		<span class="hljs-keyword">if</span> ( RightExpr ) <span class="hljs-keyword">delete</span> RightExpr;<br>	&#125;<br>	<br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;BinaryExpr(&quot;</span>) + Op + <span class="hljs-string">&quot;,&quot;</span> + getString(LeftExpr) + <span class="hljs-string">&quot;,&quot;</span> + getString(RightExpr) + <span class="hljs-string">&quot;)&quot;</span>;<br>	&#125;<br><br>&#125;;<br><br><span class="hljs-comment">// UnaryExpr(unary_operator op, expr value)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UnaryExprAST</span>:</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	<span class="hljs-built_in">string</span> Op; <span class="hljs-comment">// UnaryMinus | Not</span><br>	ExprAST * Expr;<br><br>	<span class="hljs-keyword">public</span>:<br>		UnaryExprAST(<span class="hljs-built_in">string</span> op, ExprAST * expr): Op(op), Expr(expr) &#123;&#125;;<br>		~UnaryExprAST() &#123;<br>			<span class="hljs-keyword">if</span> ( Expr ) <span class="hljs-keyword">delete</span> Expr;<br>		&#125;<br><br>		<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>			<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;UnaryExpr(&quot;</span>) + Op + <span class="hljs-string">&quot;,&quot;</span> + getString(Expr) + <span class="hljs-string">&quot;)&quot;</span>;<br>		&#125;<br>&#125;;<br><br><br><span class="hljs-comment">// IfStmt(expr condition, block if_block, block? else_block)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IfStmtAST</span>:</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	ExprAST * ConditionExpr;<br>	BlockAST * IfBlock;<br>	BlockAST * ElseBlock;<br><br>	<span class="hljs-keyword">public</span>:<br>		IfStmtAST(ExprAST * condition, BlockAST * ifblock, BlockAST * elseblock): ConditionExpr(condition), IfBlock(ifblock), ElseBlock(elseblock) &#123;&#125;;<br>		~IfStmtAST() &#123;<br>			<span class="hljs-keyword">if</span> ( ConditionExpr ) <span class="hljs-keyword">delete</span> ConditionExpr;<br>			<span class="hljs-keyword">if</span> ( IfBlock ) <span class="hljs-keyword">delete</span> IfBlock;<br>			<span class="hljs-keyword">if</span> ( ElseBlock ) <span class="hljs-keyword">delete</span> ElseBlock;<br>		&#125;<br><br>		<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>			<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;IfStmt(&quot;</span>) + getString(ConditionExpr) + <span class="hljs-string">&quot;,&quot;</span> + getString(IfBlock) + <span class="hljs-string">&quot;,&quot;</span> + getString(ElseBlock) + <span class="hljs-string">&quot;)&quot;</span>;<br>		&#125;<br>&#125;;<br><br><span class="hljs-comment">// WhileStmt(expr condition, block while_block)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WhileStmtAST</span>:</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	ExprAST * ConditionExpr;<br>	BlockAST * WhileBlock;<br><br>	<span class="hljs-keyword">public</span>:<br>	WhileStmtAST(ExprAST * cond, BlockAST * block): ConditionExpr(cond), WhileBlock(block) &#123;&#125; ;<br>	~WhileStmtAST() &#123;<br>		<span class="hljs-keyword">if</span> ( ConditionExpr ) <span class="hljs-keyword">delete</span> ConditionExpr;<br>		<span class="hljs-keyword">if</span> ( WhileBlock ) <span class="hljs-keyword">delete</span> WhileBlock;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;WhileStmt(&quot;</span>) + getString(ConditionExpr) + <span class="hljs-string">&quot;,&quot;</span> + getString(WhileBlock) + <span class="hljs-string">&quot;)&quot;</span>;<br>	&#125;<br>&#125;;<br><br><span class="hljs-comment">// ForStmt(assign* pre_assign_list, expr condition, assign* loop_assign_list, block for_block)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ForStmtAST</span>:</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	decafStmtList * PreAssignList;<br>	ExprAST * Condition;<br>	decafStmtList * LoopAssignList;<br>	BlockAST * ForBlock;<br>	<span class="hljs-keyword">public</span>:<br>		ForStmtAST(decafStmtList * pre_assign_list, ExprAST * condition, decafStmtList * loop_assign_list, BlockAST * for_block):<br>			PreAssignList(pre_assign_list), Condition(condition), LoopAssignList(loop_assign_list), ForBlock(for_block) &#123;&#125;;<br>		~ForStmtAST() &#123;<br>			<span class="hljs-keyword">if</span> ( PreAssignList ) <span class="hljs-keyword">delete</span> PreAssignList;<br>			<span class="hljs-keyword">if</span> ( Condition ) <span class="hljs-keyword">delete</span> Condition;<br>			<span class="hljs-keyword">if</span> ( LoopAssignList ) <span class="hljs-keyword">delete</span> LoopAssignList;<br>			<span class="hljs-keyword">if</span> ( ForBlock ) <span class="hljs-keyword">delete</span> ForBlock;<br>		&#125;<br><br>		<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>			<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;ForStmt(&quot;</span>) + getString(PreAssignList) + <span class="hljs-string">&quot;,&quot;</span> + getString(Condition) + <span class="hljs-string">&quot;,&quot;</span> + getString(LoopAssignList) + <span class="hljs-string">&quot;,&quot;</span> + getString(ForBlock) + <span class="hljs-string">&quot;)&quot;</span>;<br>		&#125;<br>&#125;;<br><br><span class="hljs-comment">// ReturnStmt(expr? return_value)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReturnStmtAST</span>:</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	ExprAST * ReturnValue;<br>	<span class="hljs-keyword">public</span>:<br>		ReturnStmtAST(ExprAST * return_value): ReturnValue(return_value) &#123;&#125;;<br>		~ReturnStmtAST() &#123;<br>			<span class="hljs-keyword">if</span> ( ReturnValue ) <span class="hljs-keyword">delete</span> ReturnValue;<br>		&#125;<br>		<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123;<br>			<span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;ReturnStmt(&quot;</span>) + getString(ReturnValue) + <span class="hljs-string">&quot;)&quot;</span>; <br>		&#125;<br>&#125;;<br><br><span class="hljs-comment">// BreakStmt</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BreakStmtAST</span>:</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	<span class="hljs-keyword">public</span>:<br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;BreakStmt&quot;</span>); &#125;<br>&#125;;<br><br><span class="hljs-comment">// ContinueStmt</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContinueStmtAST</span>:</span> <span class="hljs-keyword">public</span> decafAST &#123;<br>	<span class="hljs-keyword">public</span>:<br>	<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">str</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;ContinueStmt&quot;</span>); &#125;<br><br>&#125;;<br></code></pre></td></tr></table></figure>
<p>下一步？ 上 LLVM。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/compiler/">compiler</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/homework/">homework</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/01/31/LLVM-Practice/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">LLVM Practice</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/01/18/StarCTF-Reverse-writeUp/">
                        <span class="hidden-mobile">StarCTF Reverse writeUp</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <div id="gitalk-container"></div>
  <script type="text/javascript">
    Fluid.utils.waitElementVisible('gitalk-container', function() {
      Fluid.utils.createCssLink('/css/gitalk.css')
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/gitalk@1.7.0/dist/gitalk.min.js', function () {
        var gitalk = new Gitalk({
          clientID: '2e60164d74c132464b61',
          clientSecret: '52a91b30d8b32af23cbb6d7c3ce8950d27240133',
          repo: 'P4nda0s.github.io',
          owner: 'P4nda0s',
          admin: ["P4nda0s"],
          id: '1f0f9f9c274778742c869c4a7599c28e',
          language: 'zh-CN',
          labels: ["Gitalk"],
          perPage: 10,
          pagerDirection: 'last',
          createIssueManually: true,
          distractionFreeMode: false
        });
        gitalk.render('gitalk-container');
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



</body>
</html>
